<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grow a Garden Tycoon</title>
  <style>
    body { font-family: sans-serif; background: #cfe; text-align: center; }
    #game { display: grid; grid-template-rows: repeat(10, 40px); grid-template-columns: repeat(10, 40px); width: 400px; margin: 20px auto; }
    .tile {
      width: 40px;
      height: 40px;
      border: 1px solid #888;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .player { background: blue; color: white; font-weight: bold; }
    .seed-merchant { background: yellow; }
    .sell-merchant { background: gold; }
    .garden { background: brown; }
    .planted { background: green; }
    .ready { background: orange; }
    .wet { background: lightblue; }
    #ui { margin-top: 10px; }
    #message { font-weight: bold; }
  </style>
</head>
<body>

<h2>üå± Grow-a-Garden Tycoon</h2>
<p>Coins: <span id="coins">20</span> | Seeds: <span id="inventory">0</span> | Weather: <span id="weather">‚òÄÔ∏è Clear</span></p>
<p id="message"></p>
<div id="game"></div>
<div id="ui"></div>

<script>
  const gameEl = document.getElementById("game");
  const coinsEl = document.getElementById("coins");
  const inventoryEl = document.getElementById("inventory");
  const messageEl = document.getElementById("message");
  const uiEl = document.getElementById("ui");
  const weatherEl = document.getElementById("weather");

  const width = 10;
  const height = 10;
  const map = [];

  let player = { x: 4, y: 9 };
  let coins = 20;
  let inventory = 0;
  let garden = [];

  const SEED_PRICE = 5;
  let seedShopAvailable = true;
  let currentWeather = "Clear";

  // Build map
  for (let y = 0; y < height; y++) {
    map[y] = [];
    for (let x = 0; x < width; x++) {
      if (y === 0 && x === 2) map[y][x] = "seed-merchant";
      else if (y === 0 && x === 7) map[y][x] = "sell-merchant";
      else if (y >= 3 && y <= 6 && x >= 3 && x <= 6) {
        map[y][x] = "garden";
        garden.push({ x, y, status: "empty", timer: 0, wet: false });
      } else map[y][x] = "empty";
    }
  }

  function draw() {
    gameEl.innerHTML = "";
    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const tile = document.createElement("div");
        tile.className = "tile";

        const gTile = garden.find(g => g.x === x && g.y === y);
        if (gTile) {
          if (gTile.status === "planted") tile.classList.add("planted");
          if (gTile.status === "ready") tile.classList.add("ready");
          if (gTile.status === "ready" && gTile.wet) tile.classList.add("wet");
          else tile.classList.add("garden");
        } else {
          tile.classList.add(map[y][x]);
        }

        if (player.x === x && player.y === y) {
          tile.textContent = "üë®‚Äçüåæ";
          tile.classList.add("player");
        }

        gameEl.appendChild(tile);
      }
    }

    coinsEl.textContent = coins;
    inventoryEl.textContent = inventory;

    // Update UI
    const nearby = checkNearby();
    uiEl.innerHTML = "";
    if (nearby === "seed-merchant") {
      const btn = document.createElement("button");
      btn.textContent = `Buy Seed ($${SEED_PRICE})`;
      btn.onclick = () => {
        if (coins >= SEED_PRICE) {
          coins -= SEED_PRICE;
          inventory += 1;
          showMessage("You bought a seed!");
        } else {
          showMessage("Not enough coins!");
        }
        draw();
      };
      uiEl.appendChild(btn);
    }
    if (nearby === "sell-merchant") {
      const btn = document.createElement("button");
      btn.textContent = "Sell Ready Crops";
      btn.onclick = () => {
        let sold = 0;
        garden.forEach(g => {
          if (g.status === "ready") {
            coins += g.wet ? 20 : 10;
            g.status = "empty";
            g.timer = 0;
            g.wet = false;
            sold++;
          }
        });
        if (sold > 0) {
          showMessage(`Sold ${sold} crop(s)!`);
        } else {
          showMessage("No crops ready to sell.");
        }
        draw();
      };
      uiEl.appendChild(btn);
    }
  }

  function showMessage(msg) {
    messageEl.textContent = msg;
    setTimeout(() => { messageEl.textContent = ""; }, 2000);
  }

  function checkNearby() {
    const offsets = [
      { dx: 0, dy: 0 },
      { dx: 1, dy: 0 },
      { dx: -1, dy: 0 },
      { dx: 0, dy: 1 },
      { dx: 0, dy: -1 },
    ];
    for (let offset of offsets) {
      const nx = player.x + offset.dx;
      const ny = player.y + offset.dy;
      if (map[ny] && map[ny][nx] === "seed-merchant") return "seed-merchant";
      if (map[ny] && map[ny][nx] === "sell-merchant") return "sell-merchant";
    }
    return null;
  }

  function updateGardenGrowth() {
    garden.forEach(g => {
      if (g.status === "planted") {
        g.timer -= 1;
        if (g.timer <= 0) {
          g.status = "ready";
        }
      }
    });
  }

  function triggerWeatherEvent() {
    const isRain = Math.random() < 0.4; // 40% chance of rain
    if (isRain) {
      currentWeather = "üåß Rain";
      weatherEl.textContent = currentWeather;

      garden.forEach(g => {
        if (g.status === "ready" && !g.wet) {
          const mutate = Math.random() < 0.15;
          if (mutate) g.wet = true;
        }
      });
    } else {
      currentWeather = "‚òÄÔ∏è Clear";
      weatherEl.textContent = currentWeather;
    }
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp" && player.y > 0) player.y--;
    if (e.key === "ArrowDown" && player.y < height - 1) player.y++;
    if (e.key === "ArrowLeft" && player.x > 0) player.x--;
    if (e.key === "ArrowRight" && player.x < width - 1) player.x++;

    const onGarden = garden.find(g => g.x === player.x && g.y === player.y);
    if (e.key === " " && onGarden) {
      if (onGarden.status === "ready") {
        coins += onGarden.wet ? 20 : 10;
        showMessage("Harvested a " + (onGarden.wet ? "wet " : "") + "crop!");
        onGarden.status = "empty";
        onGarden.timer = 0;
        onGarden.wet = false;
      } else if (onGarden.status === "empty" && inventory > 0) {
        onGarden.status = "planted";
        onGarden.timer = 10;
        inventory--;
        showMessage("Planted a seed!");
      } else {
        showMessage("Nothing to do here.");
      }
    }
    draw();
  });

  // Game Loop
  setInterval(() => {
    updateGardenGrowth();
    draw();
  }, 1000);

  // Weather Loop every 30 seconds
  setInterval(() => {
    triggerWeatherEvent();
    draw();
  }, 30000);

  draw();
</script>

</body>
</html>
